	<div id="allmap"></div>

<script>

function init(){

	var map = new BMap.Map("allmap"); 
	var point = new BMap.Point(gon.city.longitude, gon.city.lattitude)
	map.centerAndZoom(point, 13);
	map.addControl(new BMap.MapTypeControl());

	var opts = {
	    width: 80,
	    height: 50,
	    enableMessage:true,
	    enableCloseOnClick:true,
	    enableAutoPan:true
	};

	if (gon.projects.length > 1){
		$.each(gon.projects, function(key, val) {
				marker = new BMap.Marker(new BMap.Point(val.longitude, val.lattitude));
				content = "<p>" + val.image_filename + "</p>"+ "<h4>" + val.name + "</h4>";
				addClickHandler(content, marker);
				map.addOverlay(marker);	
		}); //end of .each()
	} else {
		marker = new BMap.Marker(new BMap.Point(gon.projects.longitude, gon.projects.lattitude));
		content = "<h4>" + gon.projects.name + "</h4>";
		addClickHandler(content, marker);
		map.addOverlay(marker);	
	}

	function openInfo(content, e){
	    var p = e.target;
	    var point = new BMap.Point(p.getPosition().lng, p.getPosition().lat);
	    var infoWindow = new BMap.InfoWindow(content,opts);  // 创建信息窗口对象 
	    map.openInfoWindow(infoWindow, point); //开启信息窗口
	}

	function addClickHandler(content, marker) {
		marker.addEventListener("click", function(e){
		openInfo(content,e)
		});
	}

}

</script>